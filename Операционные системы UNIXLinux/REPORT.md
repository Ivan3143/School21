# Операционные системы UNIX/Linux

## Part 1. Установка ОС

- Установил **Ubuntu 20.04 Server LTS** без графического интерфейса, используя программу для виртуализации — VirtualBox
- Проверил версию Ubuntu командой `cat /etc/issue`

![Версия Ubuntu](../datasets/photo1.png)  
*Рис. 1: Версия Ubuntu*

## Part 2. Создание пользователя

- Создал нового пользователя `williant` командой `useradd williant`
- Назначил пароль пользователю командой `passwd williant`
- Проверил создание пользователя командой `cat /etc/passwd`
- Добавил пользователя `williant` в группу `adm` командой `usermod -a -G adm williant`
- Проверил группы пользователя командой `groups williant`

![Проверка создания пользователя](../datasets/photo2.png)  
*Рис. 2: Проверка создания пользователя*

![Проверка групп пользователя](../datasets/photo3.png)  
*Рис. 3: Проверка групп пользователя*

## Part 3. Настройка сети ОС

- Задал название машине `user-1` командой `sudo hostnamectl set-hostname user-1`
- Установил временную зону `Europe/Moscow` командой `sudo timedatectl set-timezone Europe/Moscow`
- Вывел названия сетевых интерфейсов командой `ls /sys/class/net`
- Получил IP-адрес устройства от DHCP-сервера командой `cat /var/log/syslog | grep -i dhcp`
- Определил внешний IP-адрес шлюза командой `curl ifconfig.co`
- Определил внутренний IP-адрес шлюза командой `ip route show default`
- Задал статичные настройки сети через файл `/etc/netplan/00-installer-config.yaml`
- Перезагрузил систему и проверил сетевые настройки

![Проверка имени машины](../datasets/photo4.png)  
*Рис. 4: Проверка имени машины*

![Проверка времени](../datasets/photo5.png)  
*Рис. 5: Проверка времени*

![Названия сетевых интерфейсов](../datasets/photo6.png)  
*Рис. 6: Названия сетевых интерфейсов*

![Проверка loopback интерфейса](../datasets/photo7.png)  
*Рис. 7: Проверка loopback интерфейса*

> **lo (loopback)** — виртуальный сетевой интерфейс в Linux. В отличие от обычных сетевых интерфейсов, которые представляют физические аппаратные устройства, lo не имеет физических кабелей или подключения к другим устройствам. Это часть внутреннего стека TCP/IP операционной системы. IP-адрес: 127.0.0.1. Для петлевых интерфейсов зарезервирован диапазон адресов IPv4 127.0.0.0/8, но lo обычно использует первый адрес в этом диапазоне.  
> **DNS-имя:** localhost. Посмотреть привязку можно в файле `/etc/hosts`.

![Получение IP-адреса от DHCP](../datasets/photo8.png)  
*Рис. 8: Получение IP-адреса (10.0.2.15) устройства*

> **DHCP (Dynamic Host Configuration Protocol)** — протокол динамической настройки узла. Он автоматически назначает IP-адреса и другие сетевые параметры устройствам в сети.

![Внешний IP-адрес шлюза](../datasets/photo9.png)  
*Рис. 9: Получение внешнего IP-адреса шлюза*

![Внутренний IP-адрес шлюза](../datasets/photo10.png)  
*Рис. 10: Получение внутреннего IP-адреса (10.0.2.2) шлюза*

![Конфигурационный файл сети](../datasets/photo11.png)  
*Рис. 11: Конфигурационный файл сети*

![IP-адрес устройства](../datasets/photo12.png)  
*Рис. 12: IP-адрес устройства*

![IP-адрес внешнего шлюза](../datasets/photo13.png)  
*Рис. 13: IP-адрес внешнего шлюза*

![DNS настройки](../datasets/photo14.png)  
*Рис. 14: DNS*

![Проверка соединения](../datasets/photo15.png)  
*Рис. 15: Результат ping*

## Part 4. Обновление ОС

- Выполнил обновление системы командами:
  - `sudo apt update`
  - `sudo apt full-upgrade`

![Результат обновления](../datasets/photo16.png)  
*Рис. 16: Результат обновления*

![Результат обновления](../datasets/photo17.png)  
*Рис. 17: Результат обновления*

## Part 5. Использование команды sudo

- Добавил пользователя `williant` в группу `sudo` командой `sudo usermod -aG sudo williant`
- Поменял hostname ОС от имени пользователя `williant` с использованием `sudo`

> **sudo** - утилита для операционных систем семейства Linux, которая позволяет пользователю запускать программы с привилегиями другой учётной записи, как правило, суперпользователя. Любая программа, запущенная через sudo, наследует права root — уязвимость в этой программе означает компрометацию всей системы.

![Смена hostname через sudo](../datasets/photo18.png)  
*Рис. 18: Результат*

## Part 6. Установка и настройка службы времени

- Настроил службу автоматической синхронизации времени

![Настройка времени](../datasets/photo19.png)  
*Рис. 19: Результат*

## Part 7. Установка и использование текстовых редакторов

- Установил текстовые редакторы:
  - VIM: `sudo apt install vim`
  - NANO: `sudo apt install nano`
  - MCEDIT: `sudo apt install mcedit`

### VIM

- Создал файл `test_vim.txt` и написал в нём свой никнейм, закрыл файл с сохранением изменений

> Для редактирования файла нажать `i`. После ввода текста `esc`. Для выхода с сохранением изменений `:wq`.

![Содержимое файла test_vim.txt](../datasets/photo20.png)  
*Рис. 20: Содержимое файла test_vim.txt*

- Открыл файл на редактирование, отредактировал файл, заменил никнейм на строку «21 School 21», закрыл файл без сохранения изменений

> Входим в режим редактирования `i`, набираем текст. После редактирования `esc`. Для выхода без сохранения изменений `:q!`.

![Содержимое файла test_vim.txt](../datasets/photo21.png)  
*Рис. 21: Содержимое файла test_vim.txt*

- Отредактировал файл, а затем освоил функции поиска по содержимому файла и заменил слова на любое другое

![Поиск в VIM](../datasets/photo22.png)  
*Рис. 22: Поиск*

![Замена в VIM](../datasets/photo23.png)  
*Рис. 23: Замена*

### NANO

- Создал файл `test_nano.txt` и написал в нём свой никнейм, закрыл файл с сохранением изменений

> Для редактирования вводить текст. Для выхода с сохранением изменений `control + x`, затем `y` и `enter`.

![Содержимое файла test_nano.txt](../datasets/photo24.png)  
*Рис. 24: Содержимое файла test_nano.txt*

- Открыл файл на редактирование, отредактировал файл, заменил никнейм на строку «21 School 21», закрыл файл без сохранения изменений

> Заменяем текст. Для выхода без сохранения изменений `control + x`, затем `n`.

![Содержимое файла test_nano.txt](../datasets/photo25.png)  
*Рис. 25: Содержимое файла test_nano.txt*

- Отредактировал файл, а затем освоил функции поиска по содержимому файла и заменил слова на любое другое

> Поиск осуществляется через нажатие `control + w` и ввода искомого слова, затем `enter`.  
> Команда для замены слова на другое `control + \`, вводим искомое слово, затем `enter`, вводим замену, `enter`, и `y`.

![Поиск в NANO](../datasets/photo26.png)  
*Рис. 26: Поиск*

![Замена в NANO](../datasets/photo27.png)  
*Рис. 27: Замена*

### MCEDIT

- Создал файл `test_mcedit.txt` и написал в нём свой никнейм, закрыл файл с сохранением изменений

> Содержимое файла test_mcedit.txt перед закрытием. Для редактирования вводить текст. Для выхода с сохранением изменений `esc` или `F10`, затем выбрать `Да`.

![Содержимое файла test_mcedit.txt](../datasets/photo28.png)  
*Рис. 28: Содержимое файла test_mcedit.txt*

- Открыл файл на редактирование, отредактировал файл, заменил никнейм на строку «21 School 21», закрыл файл без сохранения изменений

> Заменяем текст. Содержимое файла test_mcedit.txt перед закрытием. Для редактирования вводить текст. Для выхода с сохранением изменений `esc` или `F10`, затем выбрать `Да`.

![Содержимое файла test_mcedit.txt](../datasets/photo30.png)  
*Рис. 29: Содержимое файла test_mcedit.txt*

- Отредактировал файл, а затем освоил функции поиска по содержимому файла и заменил слова на любое другое

> Поиск осуществляется через нажатие `F7` и ввода искомого слова, затем `enter`.  
> Команда для замены слова на другое `F4`, вводим искомое слово, вводим замену, `enter`, и еще раз `enter`.

![Поиск в MCEDIT](../datasets/photo29.png)  
*Рис. 30: Поиск*

![Замена в MCEDIT](../datasets/photo31.png)  
*Рис. 31: Замена*

## Part 8. Установка и базовая настройка сервиса SSHD

- Установил службу SSHd командами:
  - `sudo apt update`
  - `sudo apt install openssh-server`
- Добавил автостарт службы: `sudo systemctl enable ssh`
- Перенастроил службу на порт 2022 через файл `/etc/ssh/sshd_config`
- Перезагрузил службу: `sudo systemctl restart sshd`
- Проверил наличие процесса: `ps -C sshd`
- Перезагрузил систему: `sudo reboot`
- Проверил прослушивание порта: `netstat -tan`

![Редактирование файла конфигурации](../datasets/photo32.png)  
*Рис. 32: Редактирование файла конфигурации*

![Процесс SSHD](../datasets/photo33.png)  
*Рис. 33: Процесс SSHD*

> Команда `ps` Linux может быть очень полезной если система перегружена и вам необходимо срочно узнать запущенные процессы linux чтобы освободить память или ресурсы процессора. Интерактивные средства не всегда могут помочь, потому что они потребляют слишком много ресурсов. С другой стороны ps дает большую гибкость поскольку утилита имеет множество опций и параметров.

### Основные ключи команды ps

| Ключ | Описание |
|------|----------|
| `-A`, `-e`, `a` | Выбрать все процессы |
| `-a` | Выбрать все процессы, кроме фоновых |
| `-d`, `g` | Выбрать все процессы, даже фоновые, кроме процессов сессий |
| `-N` | Выбрать все процессы кроме указанных |
| `-C` | Выбрать процессы по имени команды |
| `-G` | Выбрать процессы по ID группы |
| `-p`, `p` | Выбрать процессы по PID |
| `--ppid` | Выбрать процессы по PID родительского процесса |
| `-s` | Выбрать процессы по ID сессии |
| `-t`, `t` | Выбрать процессы по tty |
| `-u`, `U` | Выбрать процессы пользователя |

![Вывод netstat -tan](../datasets/photo34.png)  
*Рис. 34: Вывод `tcp 0 0 0.0.0.0:2022 0.0.0.0:* LISTEN`*

**Ключи команды netstat:**
- `-t` - только TCP соединения
- `-a` - все соединения (прослушивающие и установленные)
- `-n` - числовой формат (без DNS-резолвинга)

**Столбцы вывода:**
- **Proto** - протокол (tcp/tcp6)
- **Recv-Q** - данные в очереди на получение (0 = пусто)
- **Send-Q** - данные в очереди на отправку (0 = пусто)
- **Local Address** - локальный адрес:порт
- **Foreign Address** - удаленный адрес:порт
- **State** - состояние соединения

**Значение `0.0.0.0`:** Служба прослушивает все сетевые интерфейсы сервера и принимает подключения с любого IP-адреса.

## Part 9. Установка и использование утилит top, htop

### TOP

![Вывод команды top](../datasets/photo35.png)  
*Рис. 35: Вывод команды `top`*

**Анализ вывода команды top:**
- **Uptime:** 1 минута
- **Количество авторизованных пользователей:** 1
- **Средняя загрузка системы:** 0,16 (1 мин) | 0,07 (5 мин) | 0,02 (15 мин)
- **Общее количество процессов:** 122
- **Загрузка CPU:** 0,0%
- **Загрузка памяти:** 171,4 MB из 1971,1 MB (8,7%)
- **PID процесса, занимающего больше всего памяти:** 1 (systemd - 11576 KB)
- **PID процесса, занимающего больше всего процессорного времени:** 1131 (top - 0,3% CPU)

### HTOP

![Вывод команды htop](../datasets/photo36.png)  
*Рис. 36: Вывод команды `htop`*

![Вывод отсортированный по PID](../datasets/photo37.png)  
*Рис. 37: Вывод отсортированный по PID*

![Вывод отсортированный по PERCENT_CPU](../datasets/photo38.png)  
*Рис. 38: Вывод отсортированный по PERCENT_CPU*

![Вывод отсортированный по PERCENT_MEM](../datasets/photo39.png)  
*Рис. 39: Вывод отсортированный по PERCENT_MEM*

![Вывод отсортированный по TIME](../datasets/photo40.png)  
*Рис. 40: Вывод отсортированный по TIME*

![Добавление вывода hostname, clock и uptime](../datasets/photo43.png)  
*Рис. 43: Добавление вывода hostname, clock и uptime*

## Part 10. Использование утилиты fdisk

- Запустил команды:
  - `sudo fdisk -l`
  - `free -h`

![Информация о жёстком диске](../datasets/photo44.png)  
*Рис. 44: Информация о жёстком диске*

![Состояние Swap](../datasets/photo45.png)  
*Рис. 45: Состояние Swap*

**Жесткий диск:**
- **Название:** /dev/sda
- **Размер:** 30 GiB
- **Секторов:** 62 914 560

**Текущее состояние Swap:**
- **Размер:** 2,0 GB
- **Использовано:** 0 B

## Part 11. Использование утилиты df

- Запустил команду `df`

![Результат df](../datasets/photo46.png)  
*Рис. 46: Результат*

**Корневая файловая система (/):**
- **Устройство:** /dev/mapper/ubuntu--vg-ubuntu--lv
- **Общий размер:** 13.7 GB (14,339,080 блоков по 1K)
- **Использовано:** 4.77 GB (4,990,028 блоков)
- **Свободно:** 8.21 GB (8,598,872 блоков)
- **Заполнение:** 37%
- **Единица измерения:** 1K-блоки (1024 байта)

- Запустил команду `df -Th`

![Результат df -Th](../datasets/photo47.png)  
*Рис. 47: Результат*

**Корневой раздел (/):**
- **Файловая система:** /dev/mapper/ubuntu--vg-ubuntu--lv
- **Тип файловой системы:** ext4
- **Размер раздела:** 14 GB
- **Занято:** 4,8 GB
- **Свободно:** 8,3 GB
- **Процент использования:** 37%

## Part 12. Использование утилиты du

- Запустил команду `du`

![Информация о размере всех файлов](../datasets/photo48.png)  
*Рис. 48: Информация о размере всех файлов*

- Отобразил размер папок /home, /var, /var/log в байтах: `sudo du -sb /home /var /var/log`

![Информация о размере файлов в байтах](../datasets/photo49.png)  
*Рис. 49: Информация о размере файлов в байтах*

- Отобразил размер папок в человекочитаемом виде: `sudo du -sh /home /var /var/log`

![Информация о размере файлов в человекочитаемом виде](../datasets/photo50.png)  
*Рис. 50: Информация о размере файлов в человекочитаемом виде*

- Отобразил размер всего содержимого в /var/log: `sudo du -h /var/log/*`

![Информация о размере файлов в /var/log](../datasets/photo51.png)  
*Рис. 51: Информация о размере файлов в /var/log*

## Part 13. Установка и использование утилиты ncdu

- Установил утилиту: `sudo apt install ncdu`
- Отобразил размер папок:
  - `sudo ncdu /home`
  - `sudo ncdu /var`
  - `sudo ncdu /var/log`

![Информация о размере папки в /home](../datasets/photo52.png)  
*Рис. 52: Информация о размере папки в /home*

![Информация о размере папки в /var](../datasets/photo53.png)  
*Рис. 53: Информация о размере папки в /var*

![Информация о размере папки в /var/log](../datasets/photo54.png)  
*Рис. 54: Информация о размере папки в /var/log*

## Part 14. Работа с системными журналами

- Открыл для просмотра системные журналы:
  - `/var/log/dmesg`
  - `/var/log/syslog`
  - `/var/log/auth.log`

![Просмотр /var/log/dmesg](../datasets/photo55.png)  
*Рис. 55: Просмотр /var/log/dmesg*

![Просмотр /var/log/syslog](../datasets/photo56.png)  
*Рис. 56: Просмотр /var/log/syslog*

![Просмотр /var/log/auth.log](../datasets/photo57.png)  
*Рис. 57: Просмотр /var/log/auth.log*

**Последняя успешная авторизация:**
- **Время:** 20 ноября 03:39:57
- **Пользователь:** martilea
- **Метод входа:** pam_unix(login:session)

- Перезагрузил службу SSHd: `sudo systemctl restart sshd`
- Проверил логи: `tail /var/log/auth.log`

![Сообщение о рестарте службы SSHd](../datasets/photo58.png)  
*Рис. 58: Скрин с сообщением о рестарте службы SSHd*

## Part 15. Использование планировщика заданий CRON

- Используя планировщик заданий, запустил команду uptime через каждые 2 минуты: `crontab -e`

![Планировщик заданий](../datasets/photo59.png)  
*Рис. 59: Планировщик заданий*

- Нашёл в системных журналах строчки о выполнении: `nano /var/log/syslog`

![Просмотр /var/log/syslog](../datasets/photo60.png)  
*Рис. 60: Просмотр /var/log/syslog*

- Отобразил список текущих заданий для CRON: `crontab -l`

![Список текущих заданий для CRON](../datasets/photo61.png)  
*Рис. 61: Список текущих заданий для CRON*

- Удалил все задания из планировщика заданий:
  - `crontab -r`
  - `crontab -l`

![Список текущих заданий для CRON](../datasets/photo62.png)  
*Рис. 62: Список текущих заданий для CRON*