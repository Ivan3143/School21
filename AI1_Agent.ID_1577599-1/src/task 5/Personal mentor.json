{
  "name": "Personal mentor",
  "nodes": [
    {
      "parameters": {
        "updates": [
          "message"
        ],
        "additionalFields": {}
      },
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1.2,
      "position": [
        160,
        0
      ],
      "id": "605965c6-3d52-487b-9dc8-5053a1540583",
      "name": "Telegram Trigger",
      "webhookId": "e6df6018-822e-4961-a089-6a96760ea636",
      "credentials": {
        "telegramApi": {
          "id": "HSDJl8WfPLdXpw8q",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.message.text }}",
        "options": {
          "systemMessage": "–¢—ã ‚Äî –ò–ò-–∞–≥–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ n8n, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —É—á–µ–±–Ω—ã–µ –ø–ª–∞–Ω—ã.\n\n–¢–≤–æ—è –∑–∞–¥–∞—á–∞:\n1. –ó–∞–¥–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–ø—Ä–æ—Å: \"–ß–µ–º—É –±—ã —Ç—ã —Ö–æ—Ç–µ–ª –Ω–∞—É—á–∏—Ç—å—Å—è?\" –≤ —Ä–∞–º–∫–∞—Ö —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ —É—á–µ–±–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º –∏–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—é –∏ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤—É\n2. –£—Ç–æ—á–Ω–∏ —É—Ä–æ–≤–µ–Ω—å –≤–ª–∞–¥–µ–Ω–∏—è —Ç–µ–º–æ–π (–Ω–∞—á–∞–ª—å–Ω—ã–π, —Å—Ä–µ–¥–Ω–∏–π, –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)\n3. –ù–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ñ–æ—Ä–º–∏—Ä—É–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞ —Ç–µ–º –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è\n\n–§–æ—Ä–º–∞—Ç –ø–ª–∞–Ω–∞ –æ–±—É—á–µ–Ω–∏—è (—Ç–æ—á–Ω–æ —Å–æ–±–ª—é–¥–∞–π!):\n–¢–µ–º–∞ 1: [–ø–æ–Ω—è—Ç–∏–µ 1, –ø–æ–Ω—è—Ç–∏–µ 2, –ø–æ–Ω—è—Ç–∏–µ 3...]\n–¢–µ–º–∞ 2: [–ø–æ–Ω—è—Ç–∏–µ 1, –ø–æ–Ω—è—Ç–∏–µ 2, –ø–æ–Ω—è—Ç–∏–µ 3...]\n–¢–µ–º–∞ 3: [–ø–æ–Ω—è—Ç–∏–µ 1, –ø–æ–Ω—è—Ç–∏–µ 2, –ø–æ–Ω—è—Ç–∏–µ 3...]\n\n–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:\n- –ü–æ—Å–ª–µ –ø–ª–∞–Ω–∞ –¥–æ–±–∞–≤—å —Ñ—Ä–∞–∑—É: \"–ü–ª–∞–Ω –≥–æ—Ç–æ–≤! –û—Ç–ø—Ä–∞–≤—å—Ç–µ '–≥–æ—Ç–æ–≤–æ' —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ.\"\n- –ë–æ—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Å—Ç—ã –ü–û –û–î–ù–û–ú–£ –ü–û–ù–Ø–¢–ò–Æ –∑–∞ —Ä–∞–∑\n- –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç –±—É–¥–µ—Ç –ø–æ—Å–≤—è—â–µ–Ω –æ–¥–Ω–æ–º—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–Ω—è—Ç–∏—é\n- –ü–æ–Ω—è—Ç–∏—è –Ω–µ –±—É–¥—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è\n- –ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ–º –±–æ—Ç —Å–ø—Ä–æ—Å–∏—Ç: \"–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑—É—á–∞—Ç—å –¥–∞–ª—å—à–µ?\"\n- –¢—ã ‚Äî –ò–ò-–∞–≥–µ–Ω—Ç –≤–Ω—É—Ç—Ä–∏ n8n, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —É—á–µ–±–Ω—ã–µ –ø–ª–∞–Ω—ã.\n\n–¢–≤–æ—è –∑–∞–¥–∞—á–∞:\n1. –ó–∞–¥–∞–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–æ–ø—Ä–æ—Å: \"–ß–µ–º—É –±—ã —Ç—ã —Ö–æ—Ç–µ–ª –Ω–∞—É—á–∏—Ç—å—Å—è?\" –≤ —Ä–∞–º–∫–∞—Ö —Ä–∞–±–æ—Ç—ã –Ω–∞–¥ —É—á–µ–±–Ω—ã–º –ø—Ä–æ–µ–∫—Ç–æ–º –∏–ª–∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ –∫ —Å–æ–±–µ—Å–µ–¥–æ–≤–∞–Ω–∏—é –∏ —Ç—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤—É\n2. –£—Ç–æ—á–Ω–∏ —É—Ä–æ–≤–µ–Ω—å –≤–ª–∞–¥–µ–Ω–∏—è —Ç–µ–º–æ–π (–Ω–∞—á–∞–ª—å–Ω—ã–π, —Å—Ä–µ–¥–Ω–∏–π, –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π)\n3. –ù–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å—Ñ–æ—Ä–º–∏—Ä—É–π –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω –≤ –≤–∏–¥–µ —Å–ø–∏—Å–∫–∞ —Ç–µ–º –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è\n\n–§–æ—Ä–º–∞—Ç –ø–ª–∞–Ω–∞ –æ–±—É—á–µ–Ω–∏—è (—Ç–æ—á–Ω–æ —Å–æ–±–ª—é–¥–∞–π!):\n–¢–µ–º–∞ 1: [\"–ø–æ–Ω—è—Ç–∏–µ 1\", \"–ø–æ–Ω—è—Ç–∏–µ 2\", \"–ø–æ–Ω—è—Ç–∏–µ 3\"]\n–¢–µ–º–∞ 2: [\"–ø–æ–Ω—è—Ç–∏–µ 1\", \"–ø–æ–Ω—è—Ç–∏–µ 2\", \"–ø–æ–Ω—è—Ç–∏–µ 3\"]\n–¢–µ–º–∞ 3: [\"–ø–æ–Ω—è—Ç–∏–µ 1\", \"–ø–æ–Ω—è—Ç–∏–µ 2\", \"–ø–æ–Ω—è—Ç–∏–µ 3\"]\n\n–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê:\n- –ö–∞–∂–¥–æ–µ –ø–æ–Ω—è—Ç–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –û–¢–î–ï–õ–¨–ù–´–ú —ç–ª–µ–º–µ–Ω—Ç–æ–º –≤ –∫–∞–≤—ã—á–∫–∞—Ö\n- –ù–ï –æ–±—ä–µ–¥–∏–Ω—è–π –ø–æ–Ω—è—Ç–∏—è —á–µ—Ä–µ–∑ \"–∏\" –∏–ª–∏ –¥—Ä—É–≥–∏–µ —Å–æ—é–∑—ã\n- –ü–æ—Å–ª–µ –ø–ª–∞–Ω–∞ –¥–æ–±–∞–≤—å —Ñ—Ä–∞–∑—É: \"–ü–ª–∞–Ω –≥–æ—Ç–æ–≤! –û—Ç–ø—Ä–∞–≤—å—Ç–µ '–≥–æ—Ç–æ–≤–æ' —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ.\"\n- –ë–æ—Ç –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Å—Ç—ã –ü–û –û–î–ù–û–ú–£ –ü–û–ù–Ø–¢–ò–Æ –∑–∞ —Ä–∞–∑\n- –ö–∞–∂–¥—ã–π –ø–æ—Å—Ç –±—É–¥–µ—Ç –ø–æ—Å–≤—è—â–µ–Ω –æ–¥–Ω–æ–º—É –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –ø–æ–Ω—è—Ç–∏—é\n- –ü–æ–Ω—è—Ç–∏—è –Ω–µ –±—É–¥—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è\n- –ü–æ—Å–ª–µ –∏–∑—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Ç–µ–º –±–æ—Ç —Å–ø—Ä–æ—Å–∏—Ç: \"–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑—É—á–∞—Ç—å –¥–∞–ª—å—à–µ?\"\n\n–ï–°–õ–ò –î–õ–Ø –°–û–ó–î–ê–ù–ò–Ø –ü–õ–ê–ù–ê –ù–£–ñ–ù–´ –ê–ö–¢–£–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï –ò–ó –ò–ù–¢–ï–†–ù–ï–¢–ê:\n1. –ù–µ –ø—ã—Ç–∞–π—Å—è –æ—Ç–≤–µ—á–∞—Ç—å —Å–∞–º\n2. –ù–∞–ø–∏—à–∏ —Ä–æ–≤–Ω–æ: tavily(query=\"—Ç–≤–æ–π –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –æ —Ç–µ–º–µ\")\n3. –ù–∞–ø—Ä–∏–º–µ—Ä: tavily(query=\"–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ç–µ–Ω–¥–µ–Ω—Ü–∏–∏ –≤ DevOps –Ω–∞ 2025 –≥–æ–¥\")\n4. –ù–∏–∫–∞–∫–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ —Ç–µ–∫—Å—Ç–∞, —Ç–æ–ª—å–∫–æ —ç—Ç—É —Å—Ç—Ä–æ–∫—É"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        368,
        0
      ],
      "id": "f299b4a6-f8a1-4fa8-bc9f-81d536b2d896",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "GigaChat/GigaChat-2-Max",
          "mode": "list",
          "cachedResultName": "GigaChat/GigaChat-2-Max"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        256,
        224
      ],
      "id": "e3b8f98f-1c00-4343-a464-5853127f694e",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "XdYlMinP70WDHwXb",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "function escapeMarkdownV2(text) {\n  if (!text || typeof text !== 'string') return '';\n  \n  let result = text;\n  \n  result = result\n    .replace(/\\\\\\\\\\./g, '.')      \n    .replace(/\\\\\\\\-/g, '-')      \n    .replace(/\\\\\\\\!/g, '!')      \n    .replace(/\\\\\\\\\\?/g, '?')     \n    .replace(/\\\\\\\\\\(/g, '(')     \n    .replace(/\\\\\\\\\\)/g, ')');    \n  \n  const symbols = [\n    ['_', '\\\\_'],\n    ['*', '\\\\*'],\n    ['[', '\\\\['],\n    [']', '\\\\]'],\n    ['(', '\\\\('],\n    [')', '\\\\)'],\n    ['~', '\\\\~'],\n    ['`', '\\\\`'],\n    ['>', '\\\\>'],\n    ['#', '\\\\#'],\n    ['+', '\\\\+'],\n    ['-', '\\\\-'],\n    ['=', '\\\\='],\n    ['|', '\\\\|'],\n    ['{', '\\\\{'],\n    ['}', '\\\\}'],\n    ['.', '\\\\.'],\n    ['!', '\\\\!'],\n    ['?', '\\\\?']\n  ];\n  \n  symbols.forEach(([find, replace]) => {\n    result = result.split(find).join(replace);\n  });\n  \n  return result;\n}\n\nfunction getNextConcept(userData) {\n  const topics = userData.currentPlan.topics;\n  \n  for (let t = userData.currentTopicIndex; t < topics.length; t++) {\n    const topic = topics[t];\n    const startIndex = (t === userData.currentTopicIndex) ? userData.currentConceptIndex : 0;\n    \n    for (let c = startIndex; c < topic.concepts.length; c++) {\n      const conceptKey = `${t}_${c}`;\n      if (!userData.publishedConcepts || !userData.publishedConcepts.includes(conceptKey)) {\n        return {\n          concept: topic.concepts[c],\n          topicIndex: t,\n          conceptIndex: c\n        };\n      }\n    }\n  }\n  \n  return null;\n}\n\nconst inputItem = $input.first();\nconst userMessage = inputItem.json.message?.text?.toLowerCase() || '';\nconst chatId = inputItem.json.message?.chat?.id;\nconst originalLanguage = inputItem.json.message?.text || '';\n\nif (userMessage === '–≥–æ—Ç–æ–≤–æ') {\n  const staticData = $getWorkflowStaticData('global');\n  const userData = staticData.learningPlans?.[chatId];\n  \n  if (userData?.waitingForConfirmation) {\n    userData.waitingForConfirmation = false;\n    userData.inProgress = true;\n    userData.currentTopicIndex = 0;\n    userData.currentConceptIndex = 0;\n    userData.publishedConcepts = [];\n    userData.completedTopics = [];\n    \n    const firstTopic = userData.currentPlan.topics[0];\n    const firstConcept = firstTopic.concepts[0];\n    \n    return [{\n      json: {\n        needsSearch: true,\n        searchQuery: `–û–±—ä—è—Å–Ω–µ–Ω–∏–µ \"${firstConcept}\" –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö`,\n        concept: firstConcept,\n        topicIndex: 0,\n        conceptIndex: 0,\n        chatId: chatId,\n        getNextConcept: true\n      }\n    }];\n  } else if (userData?.inProgress) {\n    const nextConcept = getNextConcept(userData);\n    \n    if (nextConcept) {\n      const conceptKey = `${nextConcept.topicIndex}_${nextConcept.conceptIndex}`;\n      if (!userData.publishedConcepts) userData.publishedConcepts = [];\n      userData.publishedConcepts.push(conceptKey);\n      \n      userData.currentTopicIndex = nextConcept.topicIndex;\n      userData.currentConceptIndex = nextConcept.conceptIndex + 1;\n      \n      return [{\n        json: {\n          needsSearch: true,\n          searchQuery: `–û–±—ä—è—Å–Ω–µ–Ω–∏–µ \"${nextConcept.concept}\" –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏`,\n          concept: nextConcept.concept,\n          topicIndex: nextConcept.topicIndex,\n          conceptIndex: nextConcept.conceptIndex,\n          chatId: chatId,\n          getNextConcept: true\n        }\n      }];\n    } else {\n      userData.inProgress = false;\n      userData.waitingForConfirmation = false;\n      \n      delete staticData.learningPlans[chatId];\n      \n      return [{\n        json: {\n          needsSearch: false,\n          response: escapeMarkdownV2(\"üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∏–∑—É—á–∏–ª–∏ –≤—Å–µ –ø–æ–Ω—è—Ç–∏—è –∏–∑ —É—á–µ–±–Ω–æ–≥–æ –ø–ª–∞–Ω–∞!\\n\\n–ß—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∏–∑—É—á–∞—Ç—å –¥–∞–ª—å—à–µ?\"),\n          chatId: chatId,\n          parse_mode: 'MarkdownV2',\n          startNewSession: true\n        }\n      }];\n    }\n  }\n}\n\nif (userMessage === '–¥–∞–ª—å—à–µ' || userMessage === 'next' || userMessage === '—Å–ª–µ–¥—É—é—â–µ–µ') {\n  const staticData = $getWorkflowStaticData('global');\n  const userData = staticData.learningPlans?.[chatId];\n  \n  if (userData?.inProgress) {\n    const nextConcept = getNextConcept(userData);\n    \n    if (nextConcept) {\n      const conceptKey = `${nextConcept.topicIndex}_${nextConcept.conceptIndex}`;\n      if (!userData.publishedConcepts) userData.publishedConcepts = [];\n      userData.publishedConcepts.push(conceptKey);\n      \n      userData.currentTopicIndex = nextConcept.topicIndex;\n      userData.currentConceptIndex = nextConcept.conceptIndex + 1;\n      \n      return [{\n        json: {\n          needsSearch: true,\n          searchQuery: `–û–±—ä—è—Å–Ω–µ–Ω–∏–µ \"${nextConcept.concept}\" –¥–ª—è –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö`,\n          concept: nextConcept.concept,\n          topicIndex: nextConcept.topicIndex,\n          conceptIndex: nextConcept.conceptIndex,\n          chatId: chatId,\n          getNextConcept: true\n        }\n      }];\n    }\n  }\n}\n\nlet aiResponse = '';\n\nif (inputItem.json.response !== undefined && inputItem.json.response !== null) {\n  aiResponse = String(inputItem.json.response);\n} else if (inputItem.json.text !== undefined && inputItem.json.text !== null) {\n  aiResponse = String(inputItem.json.text);\n} else if (inputItem.json.message && typeof inputItem.json.message === 'string') {\n  aiResponse = inputItem.json.message;\n} else if (inputItem.json.output !== undefined && inputItem.json.output !== null) {\n  aiResponse = String(inputItem.json.output);\n} else if (inputItem.json.chatOutput !== undefined && inputItem.json.chatOutput !== null) {\n  aiResponse = String(inputItem.json.chatOutput);\n} else if (inputItem.json.message?.text) {\n  aiResponse = inputItem.json.message.text;\n}\n\nconst tavilyRegex = /tavily\\s*\\(\\s*query\\s*=\\s*\"([^\"]+)\"\\s*\\)/i;\nconst tavilyMatch = aiResponse.match(tavilyRegex);\n\nif (tavilyMatch) {\n  const query = tavilyMatch[1].trim();\n  \n  return [{\n    json: {\n      needsSearch: true,\n      searchQuery: query,\n      originalQuestion: originalLanguage,\n      aiResponse: aiResponse,\n      chatId: chatId,\n      isTavilyRequest: true\n    }\n  }];\n}\n\nconst hasStrictPlanFormat = aiResponse.match(/–¢–µ–º–∞\\s*\\d+\\s*:\\s*\\[[^\\]]+\\]/i);\n\nif (hasStrictPlanFormat) {\n  const topics = [];\n  const lines = aiResponse.split('\\n');\n  \n  for (let line of lines) {\n    line = line.trim();\n    \n    const match = line.match(/–¢–µ–º–∞\\s*(\\d+)\\s*:\\s*\\[([^\\]]+)\\]/i);\n    \n    if (match) {\n      const topicNumber = match[1];\n      const conceptsString = match[2];\n      \n      const rawConcepts = conceptsString.split(',').map(c => c.trim());\n      const cleanConcepts = [];\n      \n      for (let concept of rawConcepts) {\n        let cleanConcept = concept\n          .replace(/^[\"']|[\"']$/g, '')  \n          .replace(/\\.+$/, '')          \n          .trim();\n        \n        if (cleanConcept.includes(' –∏ ')) {\n          const parts = cleanConcept.split(' –∏ ');\n          parts.forEach(part => {\n            const trimmed = part.trim();\n            if (trimmed && trimmed.length > 1) {\n              cleanConcepts.push(trimmed);\n            }\n          });\n        } else if (cleanConcept && cleanConcept.length > 1) {\n          cleanConcepts.push(cleanConcept);\n        }\n      }\n      \n      if (cleanConcepts.length > 0) {\n        topics.push({\n          name: `–¢–µ–º–∞ ${topicNumber}`,\n          concepts: cleanConcepts,\n          completed: false\n        });\n      }\n    }\n  }\n  \n  if (topics.length > 0) {\n    const staticData = $getWorkflowStaticData('global');\n    if (!staticData.learningPlans) staticData.learningPlans = {};\n    \n    delete staticData.learningPlans[chatId];\n    \n    staticData.learningPlans[chatId] = {\n      currentPlan: {\n        topics: topics,\n        createdAt: new Date().toISOString()\n      },\n      currentTopicIndex: 0,\n      currentConceptIndex: 0,\n      publishedConcepts: [],\n      waitingForConfirmation: true,\n      inProgress: false,\n      completedTopics: []\n    };\n    \n    let planMessage = \"‚úÖ *–£—á–µ–±–Ω—ã–π –ø–ª–∞–Ω —Å–æ–∑–¥–∞–Ω\\\\!*\\n\\n\";\n    planMessage += \"üìã *–í—Å–µ–≥–æ –ø–æ–Ω—è—Ç–∏–π –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è:*\\n\";\n    \n    let totalConcepts = 0;\n    topics.forEach((topic, idx) => {\n      planMessage += `\\n*${topic.name}* \\\\(${topic.concepts.length} –ø–æ–Ω—è—Ç–∏–π\\\\):\\n`;\n      topic.concepts.forEach((concept, cIdx) => {\n        const escapedConcept = escapeMarkdownV2(concept);\n        planMessage += `  ${totalConcepts + 1}\\\\. ${escapedConcept}\\n`;\n        totalConcepts++;\n      });\n    });\n    \n    planMessage += `\\n*–í—Å–µ–≥–æ: ${totalConcepts} –ø–æ–Ω—è—Ç–∏–π*\\n\\n`;\n    planMessage += \"–Ø –±—É–¥—É –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ—Å—Ç—ã *–ü–û –û–î–ù–û–ú–£ –ü–û–ù–Ø–¢–ò–Æ*\\\\.\\n\";\n    planMessage += \"–ü–æ–Ω—è—Ç–∏—è –Ω–µ –±—É–¥—É—Ç –ø–æ–≤—Ç–æ—Ä—è—Ç—å—Å—è\\\\.\\n\";\n    planMessage += \"–°–Ω–∞—á–∞–ª–∞ –≤—Å–µ –ø–æ–Ω—è—Ç–∏—è –∏–∑ –¢–µ–º—ã 1, –∑–∞—Ç–µ–º –¢–µ–º—ã 2 –∏ —Ç\\\\.–¥\\\\.\\n\\n\";\n    planMessage += \"*–û—Ç–ø—Ä–∞–≤—å—Ç–µ '–≥–æ—Ç–æ–≤–æ' —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—É—á–µ–Ω–∏–µ*\\\\.\\n\";\n    planMessage += \"_–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ '–¥–∞–ª—å—à–µ' –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–Ω—è—Ç–∏—è_\";\n    \n    return [{\n      json: {\n        needsSearch: false,\n        response: planMessage,\n        chatId: chatId,\n        parse_mode: 'MarkdownV2'\n      }\n    }];\n  }\n}\n\nconst escapedResponse = escapeMarkdownV2(aiResponse);\n\nreturn [{\n  json: {\n    needsSearch: false,\n    response: escapedResponse,\n    chatId: chatId,\n    parse_mode: 'MarkdownV2'\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        720,
        0
      ],
      "id": "95d94363-fbb7-42cc-a826-497ea3f0f70c",
      "name": "Code in JavaScript"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "0bcf0256-4f64-4e58-a0b6-627c00cadbd3",
              "leftValue": "={{ $json.needsSearch }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        976,
        0
      ],
      "id": "8ec558b4-25f0-4bc2-a250-0482d88f3d62",
      "name": "If"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nlet finalResponse = '';\nlet parseMode = 'MarkdownV2';\n\n// –ü–æ–ª—É—á–∞–µ–º –ø–µ—Ä–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç\nconst firstItem = $input.first();\n\n\n// –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç (—É–∂–µ –æ—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)\nif (firstItem.json.response !== undefined && firstItem.json.response !== null) {\n  finalResponse = String(firstItem.json.response);\n  if (firstItem.json.parse_mode) parseMode = firstItem.json.parse_mode;\n} else if (firstItem.json.output !== undefined && firstItem.json.output !== null) {\n  finalResponse = String(firstItem.json.output);\n}\n\n// –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –ø—É—Å—Ç–æ–π\nif (!finalResponse || finalResponse.trim() === '') {\n  finalResponse = \"–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞\\\\.\";\n}\n\n// –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É\nif (finalResponse.length > 4000) {\n  finalResponse = finalResponse.substring(0, 3997) + '\\\\.\\\\.\\\\.';\n}\n\n\n// –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å\nreturn [{\n  json: {\n    message: finalResponse,\n    parse_mode: parseMode\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1184,
        144
      ],
      "id": "d1d5fb30-bf72-4179-b698-d8766dc95ca6",
      "name": "Code in JavaScript1"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.tavily.com/search",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Authorization",
              "value": "Bearer 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"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"query\": \"={{$json.searchQuery}}\",\n  \"search_depth\": \"basic\",\n  \"include_answer\": true,\n  \"max_results\": 5\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1168,
        -224
      ],
      "id": "36a0b0f5-e9a2-478e-ba16-352309feaa0d",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=–ò—Å—Ö–æ–¥–Ω—ã–π –≤–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n{{ $json.query }}\n\n–û—Ç–≤–µ—Ç Tavily (JSON):\n{{ $json.answer }}\n\n–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π –ª–∞–∫–æ–Ω–∏—á–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ —ç—Ç–æ–º—É –≤–æ–ø—Ä–æ—Å—É.",
        "options": {
          "systemMessage": "–¢—ã ‚Äî —Ç–µ—Ä–ø–µ–ª–∏–≤—ã–π –ò–ò-–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –æ–±—ä—è—Å–Ω—è—Ç—å —É—á–µ–±–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è –ø—Ä–æ—Å—Ç—ã–º–∏ —Å–ª–æ–≤–∞–º–∏.\n\n–ö–û–ù–¢–ï–ö–°–¢: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑—É—á–∞–µ—Ç \"{{$json.concept}}\"\n\n–§–û–†–ú–ê–¢ –û–ë–™–Ø–°–ù–ï–ù–ò–Ø:\nüìö **–ß—Ç–æ —ç—Ç–æ?** - –∫—Ä–∞—Ç–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ\nüéØ **–û—Å–Ω–æ–≤–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏** - 2-3 –∫–ª—é—á–µ–≤—ã—Ö –º–æ–º–µ–Ω—Ç–∞  \nüìù **–ü—Ä–∏–º–µ—Ä** - –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—è\nüí° **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å** - –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ\nüöÄ **–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥** - —á—Ç–æ –∏–∑—É—á–∏—Ç—å –¥–∞–ª—å—à–µ –ø–æ —Ç–µ–º–µ\n\n–í–ê–ñ–ù–´–ï –ü–†–ê–í–ò–õ–ê –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–Ø:\n1. –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–º–≤–æ–ª–æ–≤ (–Ω–µ –ø–∏—à–∏ \\\\. \\\\- \\\\! –∏ —Ç.–¥.)\n2. –ö–æ–¥ –æ–±–æ—Ä–∞—á–∏–≤–∞–π –≤ —Ç—Ä–æ–π–Ω—ã–µ –∞–ø–æ—Å—Ç—Ä–æ—Ñ—ã –ë–ï–ó —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä:\n   ```python\n   print(\"Hello, World!\")"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        1584,
        -224
      ],
      "id": "c0a9f410-7633-402b-b470-577af1e9a829",
      "name": "AI Agent1"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "value": "GigaChat/GigaChat-2-Max",
          "mode": "list",
          "cachedResultName": "GigaChat/GigaChat-2-Max"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        1584,
        -48
      ],
      "id": "bdc1c66c-e3a5-442f-a049-ad91f1a43e79",
      "name": "OpenAI Chat Model1",
      "credentials": {
        "openAiApi": {
          "id": "XdYlMinP70WDHwXb",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.output }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1952,
        -224
      ],
      "id": "eb6f8306-f240-4532-b36f-4bc0cc86d987",
      "name": "Send a text message",
      "webhookId": "81c891e3-d331-469a-92eb-8128aff88471",
      "credentials": {
        "telegramApi": {
          "id": "HSDJl8WfPLdXpw8q",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "={{ $('Telegram Trigger').item.json.message.chat.id }}",
        "text": "={{ $json.message }}",
        "additionalFields": {
          "appendAttribution": false
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        1392,
        144
      ],
      "id": "d2a101c6-35dd-4374-ac8b-1f940c6b3eda",
      "name": "Send a text message1",
      "webhookId": "7e49918b-80c9-42a6-9045-2a244fc90050",
      "credentials": {
        "telegramApi": {
          "id": "HSDJl8WfPLdXpw8q",
          "name": "Telegram account"
        }
      }
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $json.message.chat.id }}",
        "contextWindowLength": 10
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        432,
        240
      ],
      "id": "d942638d-684c-409b-b38d-508ceb0f84be",
      "name": "Simple Memory"
    }
  ],
  "pinData": {},
  "connections": {
    "Telegram Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent": {
      "main": [
        [
          {
            "node": "Code in JavaScript",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Code in JavaScript1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "AI Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "OpenAI Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent1": {
      "main": [
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code in JavaScript1": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "812737ad-da76-44f2-8e19-8acd73266062",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "e00bf10055158732c9c2f8ed47bb56832813181d7552c1aa9dc4b0ab57e04ae7"
  },
  "id": "jvGIELbXdDVPe4R9",
  "tags": []
}